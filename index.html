<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Payroll App</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Payroll App">
<link rel="apple-touch-icon" href="icon.png">
<style>
/* 1. Global Setup */
@import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');

body {
    font-family: 'Kanit', sans-serif;
    margin: 0; padding: 15px; background: #f0f2f5; color: #333;
    display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}

.main-container { width: 100%; max-width: 400px; text-align: center; }

h2 { font-weight: 700; color: #1a1a1a; margin-bottom: 20px; }

/* 2. Dropdown (Select) ‡πÅ‡∏ö‡∏ö‡∏°‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏¢ - ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ */
select {
    appearance: none; -webkit-appearance: none; -moz-appearance: none;
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 8px 30px 8px 12px;
    font-family: 'Kanit', sans-serif;
    font-size: 14px; color: #333; cursor: pointer;
    transition: all 0.3s ease;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
}

select:focus {
    outline: none; border-color: #1976d2;
    box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
}

/* 3. Calendar & Cells */
.calendar { margin: 12px 0; }
.weekdays, .days { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; }
.weekdays { background: #e0e0e0; border-radius: 8px 8px 0 0; padding: 5px 0; font-weight: 600; font-size: 13px; color: #555; }
.weekdays div:first-child { color: #e53935; }
.weekdays div:last-child { color: #1976d2; }

.day-cell {
    background: #fff; margin: 3px; padding: 10px 0; border-radius: 10px; cursor: pointer;
    position: relative; transition: all 0.2s ease;
}
.day-cell.active { background: #1976d2; color: #fff; transform: scale(1.05); }

/* Indicators */
.day-cell::after, .day-cell::before { content: ""; width: 5px; height: 5px; border-radius: 50%; position: absolute; bottom: 4px; display: none; }
.day-cell::after { left: 35%; transform: translateX(-50%); } 
.day-cell::before { left: 65%; transform: translateX(-50%); }

.day-work::after { background: #4caf50; display: block; }
.day-leave::after { background: #ff9800; display: block; }
.day-absent::after { background: #e53935; display: block; }
.day-holiday::after { background: #607d8b; display: block; }
.shift-morning::before { background: #FFD700; display: block; }
.shift-night::before { background: #000080; display: block; }

/* 4. Forms & Settings */
.wage-row, .setting-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 12px; }
.wage-row label { font-size: 13px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
.wage-row input { width: 60px; text-align: center; font-weight: 600; border-radius: 8px; border: 1px solid #ccc; padding: 6px; font-family: 'Kanit';font-size: medium; }
#hourlyWage { background: #eee !important; border: 1px dashed #999; }

.setting-row label {
    font-size: 14px; padding: 6px 12px; background: #fff; border-radius: 8px; border: 1px solid #ddd;
    display: flex; align-items: center; cursor: pointer; transition: 0.2s;
}
.setting-row input[type="checkbox"] { width: 18px; height: 18px; margin-right: 8px; accent-color: #1976d2; }

/* 5. Specific Element Styles (Override ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î) */
#monthSelect, #yearSelect {
    background-color: #e3f2fd; border-color: #bbdefb; font-weight: 600; color: #1565c0;
}

.incentive-box { border: none; border-top: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; margin: 15px 0; padding: 12px 0; }
.incentive-box legend { font-size: 13px; font-weight: 600; color: #666; text-align: left; }
.incentive-box .setting-row {
    display: flex;
    justify-content: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á */
    gap: 10px;               /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á */
    margin-top: 5px;
}
.incentive-box label {
    flex: 1;                 /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ù‡∏±‡πà‡∏á‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
    max-width: 135px;        /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏à‡∏ô‡∏ô‡πà‡∏≤‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î */
    justify-content: center; 
}
.incentive-box select { width: 90px; height: 36px; text-align: center; padding: 4px 20px 4px 4px; font-weight: 500; }

.row select { height: 40px; border-radius: 10px; width: 100%; box-sizing: border-box; }

/* 6. Summary & Card Expand */
.triple-row { display: grid; grid-template-columns: 100px 80px auto; align-items: center; gap: 8px; padding: 5px 0; font-size: 14px; text-align: left; }
.money { font-weight: bold; text-align: right; }
.total-box { font-size: 18px; background: #2e7d32; color: #fff; border-radius: 8px; padding: 10px; margin-top: 15px; }

.calendar-expand { grid-column: 1 / -1; overflow: hidden; will-change: transform, max-height; }
.card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
#cardContainer .card { display: none; }
@media print {
    /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
    @page { size: A4; margin: 15mm; }

    /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á */
    button, select, fieldset, .calendar, h2, .wage-row, .setting-row, .no-print {
        display: none !important;
    }

    body { background: white; margin: 0; padding: 0; }

    /* ‡∏Ç‡∏¢‡∏≤‡∏¢ Container ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
    .main-container { 
        max-width: 100% !important; 
        width: 100% !important; 
    }
    
    #result { 
        display: block !important; 
        width: 100% !important;
    }

    /* ‡∏´‡∏±‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô */
    #result::before {
        content: attr(data-period);
        display: block;
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
    }

    /* ‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
    .triple-row {
        display: flex !important;
        justify-content: space-between;
        width: 100%;
        font-size: 16px;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    
    .col-1 { flex: 2; text-align: left; }
    .col-2 { flex: 1; text-align: right; }
    .col-3 { flex: 1; text-align: right; font-weight: bold; }

    /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ */
    .triple-row[style*="background"] {
        background: #2e7d32 !important;
        color: white !important;
        -webkit-print-color-adjust: exact !important;
        padding: 15px !important;
        border-radius: 5px;
    }
}
@media print {
    .no-print { display: none !important; }
}
</style>
</head>

<body>

<div class="main-container">
  <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h2>

  <div class="wage-row" style="align-items: center; margin-top: 10px;">
    <span>‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏á‡∏ß‡∏î‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span> <select id="monthSelect"></select>
    <span>‡∏õ‡∏µ:</span> <select id="yearSelect"></select>
  </div><br>

  <div class="wage-row">
    <label>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ß‡∏±‡∏ô <input type="number" id="dailyWage" value="447"></label>
    <label>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏° <input type="number" id="hourlyWage" readonly style="background:#eee"></label>
  </div>

  <div class="setting-row">
    <label><input type="checkbox" id="skillCheck"> ‡∏ó‡∏±‡∏Å‡∏©‡∏∞</label>
    <label><input type="checkbox" id="mentorCheck"> ‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label>
  </div>

  <fieldset class="incentive-box">
    <legend>‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏¢‡∏±‡∏ô (‡∏£‡∏≤‡∏¢‡∏á‡∏ß‡∏î)</legend>
    <div class="setting-row">
        <label>
            <span>‡∏£‡∏≠‡∏ö 1&nbsp;&nbsp;</span>
            <select id="incentive1">
                <option value="0">-</option>
                <option value="180">180</option>
                <option value="210">210</option>
            </select>
        </label>
        <label>
            <span>‡∏£‡∏≠‡∏ö 2&nbsp;&nbsp;</span>
            <select id="incentive2">
                <option value="0">-</option>
                <option value="180">180</option>
                <option value="210">210</option>
            </select>
        </label>
    </div>
  </fieldset>

<div class="calendar">
  <div class="weekdays">
    <div>‡∏≠‡∏≤</div><div>‡∏à</div><div>‡∏≠</div>
    <div>‡∏û</div><div>‡∏û‡∏§</div><div>‡∏®</div><div>‡∏™</div>
  </div>
  <div class="days" id="calendarDays"></div>
</div>

<div id="cardContainer"></div>

<div id="summaryContainer" style="margin-top: 20px;"></div>

<div id="result" style="margin-top:20px;"></div>

<div style="display: flex; gap: 8px; margin-top: 30px; justify-content: center;">
    <button id="pdfBtn" style="background: #e53935; color: white; border: none; padding: 8px 12px; border-radius: 10px; font-size: 13px; cursor: pointer; flex: 1;">üìÑ PDF</button>
    <button id="exportBtn" style="background: #455a64; color: white; border: none; padding: 8px 12px; border-radius: 10px; font-size: 13px; cursor: pointer; flex: 1;">üì• ‡∏™‡∏≥‡∏£‡∏≠‡∏á</button>
    <button id="importBtn" style="background: #607d8b; color: white; border: none; padding: 8px 12px; border-radius: 10px; font-size: 13px; cursor: pointer; flex: 1;">üì§ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</button>
</div>
<input type="file" id="fileInput" style="display: none;" accept=".json">

<script>

function num(v){
  return Number(v) || 0;
}

/* ===== SETUP ===== */
const daysTH=["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
const container=document.getElementById("cardContainer");
const calendarEl=document.getElementById("calendarDays");
const monthSelect=document.getElementById("monthSelect");
const yearSelect=document.getElementById("yearSelect");

const monthNames=[
  "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
  "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
];

monthNames.forEach((m,i)=>{
  const o=document.createElement("option");
  o.value=i;o.textContent=m;
  monthSelect.appendChild(o);
});

const dailyInput  = document.getElementById("dailyWage");
const hourlyInput = document.getElementById("hourlyWage");

function syncHourly(){
  const daily = num(dailyInput.value);
  hourlyInput.value = (daily / 8).toFixed(2);
}

// initial
syncHourly();

// change
dailyInput.addEventListener("input", () => {
  syncHourly();
  renderSummary();   // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
});

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á dailyInput.addEventListener
document.getElementById("skillCheck").addEventListener("change", renderSummary);
document.getElementById("mentorCheck").addEventListener("change", renderSummary);

let selectedDate=null;
let expandRow=null;
let activeCell = null; // ‚≠ê cell ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
let lastTapTime = 0;

/* ===== UTIL ===== */
function formatLocalDate(d){
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}
function getMonthKey(){
  return `payroll-${yearSelect.value}-${monthSelect.value}`;
}

/* ===== STORAGE ===== */
function saveCards(){
  const data = [...document.querySelectorAll(".card")].map(c => ({
    date: c.dataset.date,
    status: c.querySelector(".status").value,
    shift: c.querySelector(".shift").value,    // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    normal: c.querySelector(".normal").value,  // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    ot: c.querySelector(".ot").value           // ‡πÄ‡∏û‡∏¥‡πà‡∏°
  }));
  localStorage.setItem(getMonthKey(), JSON.stringify(data));
}
function loadCards(){
  return JSON.parse(localStorage.getItem(getMonthKey())||"[]");
}

/* ===== BADGE ===== */
function updateBadge(card){
  const b = card.querySelector(".badge");
  const statusEl = card.querySelector(".status");

  if (!b || !statusEl) return;

  const s = statusEl.value.trim();

  // reset class
  b.classList.remove(
    "badge-work",
    "badge-holiday",
    "badge-leave",
    "badge-absent"
  );

  // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ‚Üí ‡∏ã‡πà‡∏≠‡∏ô
  if (!s) {
    b.style.display = "none";
    return;
  }

  b.style.display = "inline-block";

  if (s === "‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô") {
    b.classList.add("badge-absent");
  }
  else if (s.includes("‡∏´‡∏¢‡∏∏‡∏î")) {
    b.classList.add("badge-holiday");
  }
  else if (s.includes("‡∏•‡∏≤") || s.includes("‡∏õ‡πà‡∏ß‡∏¢")) {
    b.classList.add("badge-leave");
  }
  else {
    b.classList.add("badge-work");
  }

  b.textContent = s;

}

function createCard(date, saved) {
  const dateStr = formatLocalDate(date);
  const card = document.createElement("div");
  card.className = "card";
  card.dataset.date = dateStr;
  card.innerHTML = `
    <div class="card-header">
      <div>${dateStr} (${daysTH[date.getDay()]})</div>
      <div class="card-actions">
        <span class="badge"></span>
      </div>
    </div>
    <div class="card-body">
      <div class="row"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
        <select class="status">
          <option>‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</option>
          <option>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</option>
          <option>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
          <option>‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
          <option>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
          <option>‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
          <option>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
          <option>‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
          <option>‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô</option>
        </select>
      </div>
      <div class="row"><label>‡∏Å‡∏∞</label>
        <select class="shift"><option></option><option>‡πÄ‡∏ä‡πâ‡∏≤</option><option>‡∏î‡∏∂‡∏Å</option></select>
      </div>
      <div class="row"><label>‡∏õ‡∏Å‡∏ï‡∏¥</label>
        <select class="normal"><option value="0">0</option><option value="4">4</option><option value="8">8</option></select>
      </div>
      <div class="row"><label>‡πÇ‡∏≠‡∏ó‡∏µ</label>
        <select class="ot">
          <option value="0">0</option>
          <option value="0.17">0.17</option>
          <option value="2.51">2.51</option>
          <option value="4.51">4.51</option>
        </select>
      </div>
    </div>
  `;
  
  container.appendChild(card);

  // --- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Load Saved Data) ---
  const statusSelect = card.querySelector(".status");
  const shiftSelect = card.querySelector(".shift");
  const normalSelect = card.querySelector(".normal");
  const otSelect = card.querySelector(".ot");

  statusSelect.value = saved?.status || "‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
  shiftSelect.value = saved?.shift || "";
  normalSelect.value = saved?.normal || "0";
  otSelect.value = saved?.ot || "0";

  updateBadge(card);

  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô createCard
  [statusSelect, shiftSelect, normalSelect, otSelect].forEach(el => {
      el.onchange = () => {
          updateBadge(card);
          saveCards();      
        
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏µ‡∏ö‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
          const cell = document.querySelector(`.day-cell[data-date="${card.dataset.date}"]`);
          if (cell) {
              // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡∏≤‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
              cell.classList.remove("day-work", "day-holiday", "day-leave", "day-absent", "shift-morning", "shift-night");
            
              //  ‡πÉ‡∏™‡πà‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏à‡∏∏‡∏î‡∏ã‡πâ‡∏≤‡∏¢)
              const sClass = getStatusClass(statusSelect.value);
              if (sClass) cell.classList.add(sClass);
            
              // ‡πÉ‡∏™‡πà‡∏Ñ‡∏•‡∏≤‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Å‡∏∞ (‡∏à‡∏∏‡∏î‡∏Ç‡∏ß‡∏≤)
              const shClass = getShiftClass(shiftSelect.value);
              if (shClass) cell.classList.add(shClass);
          }

          renderSummary(); 
      };
  });
}
/* ===== CALENDAR ===== */
function getStatusClass(status) {
    if (status.includes("‡∏´‡∏¢‡∏∏‡∏î")) return "day-holiday";
    if (status.includes("‡∏•‡∏≤")) return "day-leave";
    if (status === "‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô") return "day-absent";
    return "day-work";
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏∞
function getShiftClass(shift) {
    if (shift === "‡πÄ‡∏ä‡πâ‡∏≤") return "shift-morning";
    if (shift === "‡∏î‡∏∂‡∏Å") return "shift-night";
    return "";
}

function renderCalendar() {
    calendarEl.innerHTML = "";
    selectedDate = null;
    removeExpand(true);

    const y = +yearSelect.value;
    const m = +monthSelect.value;
    
    // ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 16 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏ñ‡∏∂‡∏á 15 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
    const start = new Date(y, m - 1, 16);
    const end = new Date(y, m, 15);

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á (Blank) ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å
    // ‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16 (‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏Å) ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏≠‡∏∞‡πÑ‡∏£ (0=‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå, 6=‡πÄ‡∏™‡∏≤‡∏£‡πå)
    const firstDayType = start.getDay(); 
    for (let i = 0; i < firstDayType; i++) {
        const blank = document.createElement("div");
        blank.className = "day-cell-blank"; 
        calendarEl.appendChild(blank);
    }

    // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
    const savedDataList = loadCards();

    // 3. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16 ‡∏ñ‡∏∂‡∏á 15
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        const key = formatLocalDate(d);
        const dayOfWeek = d.getDay();

        const cell = document.createElement("div");
        cell.className = "day-cell";
        cell.textContent = d.getDate(); // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (16, 17, ... 1, 2, ... 15)
        cell.dataset.date = key;

        // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡∏™‡∏µ Status ‡πÅ‡∏•‡∏∞ Shift
        const dayData = savedDataList.find(x => x.date === key);
        if (dayData) {
            const sClass = getStatusClass(dayData.status);
            if (sClass) cell.classList.add(sClass);
            
            const shClass = getShiftClass(dayData.shift);
            if (shClass) cell.classList.add(shClass);
        }

        cell.onclick = () => toggleInline(cell);
        calendarEl.appendChild(cell);
    }
}

function slideOpen(element) {
  element.animate([
    {
      maxHeight: "0px",
      opacity: 0,
      transform: "translateY(-10px)" // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á
    },
    {
      maxHeight: "500px", // ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
      opacity: 1,
      transform: "translateY(0)"
    }
  ], {
    duration: 350, // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πâ‡∏≤-‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (350ms ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏∏‡πà‡∏°)
    easing: "ease-out", // ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏ö
    fill: "forwards"
  });
}

function slideClose(element) {
  return element.animate([
    {
      maxHeight: "500px",
      opacity: 1,
      transform: "translateY(0)"
    },
    {
      maxHeight: "0px",
      opacity: 0,
      transform: "translateY(-10px)"
    }
  ], {
    duration: 250,
    easing: "ease-in",
    fill: "forwards"
  }).finished; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ promise ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö animation
}

function toggleInline(cell) {
    const dateKey = cell.dataset.date;
    const cells = [...calendarEl.children];
    const index = cells.indexOf(cell);
    const rowIndex = Math.floor(index / 7);
    const rowEnd = rowIndex * 7 + 6;

    /* 1. ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡πâ‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° -> ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î */
    if (selectedDate === dateKey && activeCell === cell && expandRow) {
        slideClose(expandRow).then(() => {
            removeExpand(true);
            cell.classList.remove("active"); // ‡∏•‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î
            selectedDate = null;
            activeCell = null;
        });
        return;
    }

    /* 2. ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß) */
    
    // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏∞‡πÑ‡∏£
    const isSameRow = expandRow && expandRow.dataset.rowIndex == rowIndex;

    // ‡∏•‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô
    document.querySelectorAll(".day-cell").forEach(c => c.classList.remove("active"));
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà
    cell.classList.add("active");
    
    selectedDate = dateKey;
    activeCell = cell;

    if (isSameRow) {
        /* --- ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏¥‡∏°: ‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ --- */
        const card = document.querySelector(`.card[data-date="${dateKey}"]`);
        if (card) {
            const oldCard = expandRow.querySelector(".card");
            if (oldCard) {
                document.getElementById("cardContainer").appendChild(oldCard);
                oldCard.style.display = "none";
            }
            expandRow.appendChild(card);
            card.style.display = "block";
            updateBadge(card);
        }
    } else {
        /* --- ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ñ‡∏ô‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß: ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏™‡πÑ‡∏•‡∏î‡πå‡∏•‡∏á) --- */
        removeExpand(true); 

        expandRow = document.createElement("div");
        expandRow.className = "calendar-expand";
        expandRow.dataset.rowIndex = rowIndex;

        const card = document.querySelector(`.card[data-date="${dateKey}"]`);
        if (card) {
            expandRow.appendChild(card);
            card.style.display = "block";
            updateBadge(card);
        }

        // ‡πÅ‡∏ó‡∏£‡∏Å expandRow ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡πÜ
        if (cells[rowEnd + 1]) {
            calendarEl.insertBefore(expandRow, cells[rowEnd + 1]);
        } else {
            calendarEl.appendChild(expandRow);
        }

        slideOpen(expandRow);
    }
}

function removeExpand(immediate = false) {
    if (!expandRow) return;

    const cleanupLogic = () => {
        const cardInExpand = expandRow.querySelector(".card");
        if (cardInExpand) {
            document.getElementById("cardContainer").appendChild(cardInExpand);
            cardInExpand.style.display = "none";
        }
        expandRow.remove();
        expandRow = null;
    };

    if (immediate) {
        cleanupLogic();
    } else {
        // ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πÑ‡∏•‡∏î‡πå‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ slideClose ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        slideClose(expandRow).then(cleanupLogic);
    }
    
    // ‡∏•‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö .active ‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏õ (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏õ‡∏•‡∏ö‡πÉ‡∏ô toggleInline ‡πÅ‡∏ó‡∏ô)
}
// Settings
function getSettings(){
  const DAILY_WAGE = num(dailyInput.value);
  return {
    DAILY_WAGE, HOURLY_WAGE: DAILY_WAGE/8,
    OT_RATE_1:1,OT_RATE_15:1.5, OT_RATE_2:2, OT_RATE_3:3,
    NIGHT_SHIFT_FEE:140, FOOD_NIGHT_FEE:70, FOOD_OT_FEE:45, SKILL_FEE:20,MENTOR_FEE:200,
    SOCIAL_SECURITY_RATE:0.05
  };
}

/* ===== RENDER MONTH ===== */
function renderMonth(){
  container.innerHTML="";
  const y=+yearSelect.value;
  const m=+monthSelect.value;
  const start=new Date(y,m-1,16);
  const end=new Date(y,m,15);

  const saved=loadCards();
  const map={};
  saved.forEach(d=>map[d.date]=d);

  for(let d=new Date(start);d<=end;d.setDate(d.getDate()+1)){
    createCard(d,map[formatLocalDate(d)]);
  }

  document.querySelectorAll(".card").forEach(card=>{
  updateBadge(card);
  });

  renderCalendar();

  renderSummary();
}

function buildWorkTableFromCards(){

  // ‡∏•‡∏ö table ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  let table = document.getElementById("workTable");
  if (table) table.remove();

  table = document.createElement("table");
  table.id = "workTable";
  table.style.display = "none";
  document.body.appendChild(table);

  document.querySelectorAll(".card").forEach(card => {

    const tr = document.createElement("tr");
    tr.className = "data-row";

    tr.innerHTML = `
      <td>
        <select class="statusSelect">
          <option selected>${card.querySelector(".status").value}</option>
        </select>
      </td>
      <td>
        <select class="shiftSelect">
          <option selected>${card.querySelector(".shift").value}</option>
        </select>
      </td>
      <td>
        <input class="normalHour" value="${card.querySelector(".normal").value}">
      </td>
      <td>
        <input class="otHour" value="${card.querySelector(".ot").value}">
      </td>
    `;

    table.appendChild(tr);
  });
}

function renderSummary(){
  buildWorkTableFromCards(); // ‚≠ê ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
  calculate();               // ‚≠ê ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏î‡∏¥‡∏° 100%
}
function round(v, n = 0){
  const p = Math.pow(10, n);
  return Math.round(v * p) / p;
}

function format2(v){
  return Number(v || 0).toLocaleString("th-TH", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}
function countIncludeStatusNormal(statusList, normalHour = null) {
  return [...document.querySelectorAll("#workTable tr.data-row")]
    .filter(row => {
      const status = row.querySelector(".statusSelect").value;
      const normal = row.querySelector(".normalHour").value;

      if (!statusList.includes(status)) return false;
      if (normalHour === null) return true;

      return normal === String(normalHour);
    }).length;
}

// Calculation
function calculate(){
  const S=getSettings();
  const rows=document.querySelectorAll("#workTable tr.data-row");
  let workDays=0,workHours=0,ot1Hour=0,ot15Hours=0,ot2Hours=0,ot3Hours=0,nightShiftDays=0,otFoodDays=0;

  rows.forEach(row => {
    const status = row.querySelector(".statusSelect").value;
    const shift = row.querySelector(".shiftSelect").value;
    const normal = num(row.querySelector(".normalHour").value);
    const ot = num(row.querySelector(".otHour").value);
    const hasNormalOT = ot > 0.17; // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏≥ OT ‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£ OT

    // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status Logic)
    if (status === "‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô") {
      workHours += normal;
      workDays += normal / 8;
      if (ot > 0) { ot15Hours += ot; }
      if (shift === "‡∏î‡∏∂‡∏Å") nightShiftDays++;
    } 
    else if (status === "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î") { 
      ot2Hours += normal; 
      ot3Hours += ot; 
      if (shift === "‡∏î‡∏∂‡∏Å") nightShiftDays++; 
    } 
    else if (status === "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©") {
      ot1Hour += normal; 
      ot3Hours += ot;
      // ‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏∞‡∏î‡∏∂‡∏Å‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©
      if (shift === "‡∏î‡∏∂‡∏Å") nightShiftDays++; 
    }
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡∏î‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢
    else if (["‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô", "‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô", "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢", "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå", "‡∏•‡∏≤‡∏Å‡∏¥‡∏à", "‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©"].includes(status)) {
      if (shift === "‡∏î‡∏∂‡∏Å") {
        nightShiftDays++;
      }
    }

    // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£ OT (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏≠‡∏¥‡∏™‡∏£‡∏∞)
    if (hasNormalOT) {
      otFoodDays++;
    }
  });
  const cNormalday      = countIncludeStatusNormal(["‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô","‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô","‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢","‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå","‡∏•‡∏≤‡∏Å‡∏¥‡∏à","‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©"],"4") * 0.5+countIncludeStatusNormal(["‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"],"8")*1;
  const cHolidaySpecial = countIncludeStatusNormal(["‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©"]);
  const cVacation       = countIncludeStatusNormal(["‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô"],"4")*0.5+countIncludeStatusNormal(["‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô"],"0")*1;
  const cSickDoctor     = countIncludeStatusNormal(["‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå"],"4")*0.5+countIncludeStatusNormal(["‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå"],"0")*1;
  const cBusinessExtra  = countIncludeStatusNormal(["‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©"],"4")*0.5+countIncludeStatusNormal(["‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©"],"0")*1;
  const cSick           = countIncludeStatusNormal(["‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢"],"4")*0.5+countIncludeStatusNormal(["‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢"],"0")*1;
  const cBusiness       = countIncludeStatusNormal(["‡∏•‡∏≤‡∏Å‡∏¥‡∏à"],"4")*0.5+countIncludeStatusNormal(["‡∏•‡∏≤‡∏Å‡∏¥‡∏à"],"0")*1;
  const cAbsent         = countIncludeStatusNormal(["‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô"]);
  const cHoliday        = countIncludeStatusNormal(["‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"]);
  const salaryPay=cNormalday * S.DAILY_WAGE;
  const ot1Pay=S.HOURLY_WAGE*S.OT_RATE_1*ot1Hour;
  const ot15Pay=S.HOURLY_WAGE*S.OT_RATE_15*ot15Hours;
  const ot2Pay=S.HOURLY_WAGE*S.OT_RATE_2*ot2Hours;
  const ot3Pay=S.HOURLY_WAGE*S.OT_RATE_3*ot3Hours;
  const nightShiftPay=nightShiftDays*S.NIGHT_SHIFT_FEE;
  const nightFoodPay=nightShiftDays*S.FOOD_NIGHT_FEE;
  const otFoodPay=otFoodDays*S.FOOD_OT_FEE;
  const forcedOtPay=Math.floor((S.HOURLY_WAGE * S.OT_RATE_15)*0.17);
  const skillPay  = skillCheck.checked ? Math.floor(workDays) * S.SKILL_FEE : 0;
  const mentorPay=mentorCheck.checked ? S.MENTOR_FEE : 0 ;
  const holidayspecialPay=cHolidaySpecial*(S.DAILY_WAGE+forcedOtPay)
  const vacationPay=cVacation*(S.DAILY_WAGE+forcedOtPay)
  const sickdocterPay=cSickDoctor*(S.DAILY_WAGE+forcedOtPay)
  const businessextraPay=cBusinessExtra*(S.DAILY_WAGE+forcedOtPay)
  const incentive1Pay = num(document.getElementById("incentive1").value);
  const incentive2Pay = num(document.getElementById("incentive2").value);
  const totalIncome=salaryPay+ot1Pay+ot15Pay+ot2Pay+ot3Pay+
    nightShiftPay+nightFoodPay+otFoodPay+skillPay+mentorPay+
    holidayspecialPay+vacationPay+sickdocterPay+businessextraPay+
    incentive1Pay+incentive2Pay;
  const socialSecurity=round(salaryPay * S.SOCIAL_SECURITY_RATE,0);
  const netPay=totalIncome-socialSecurity;
  

  document.getElementById("result").innerHTML = `
  <div style="line-height:1.2; font-size:14px; width:100%; margin:auto;"> 

    <div class="no-print" style="text-align:center; font-size:16px; font-weight:bold; margin-bottom:10px;">
      ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    </div>

    <hr class="no-print">

    <div class="triple-row">
      <span class="col-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
      <span class="col-2"style="text-align:right;">${format2(cNormalday)} ‡∏ß‡∏±‡∏ô</span>
      <span class="col-3"></span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(salaryPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÇ‡∏≠‡∏ó‡∏µ 1 ‡πÅ‡∏£‡∏á</span>
      <span class="col-2"style="text-align:right;">${format2(ot1Hour)} ‡∏ä‡∏°.</span>
      <span class="col-3 money">${format2(ot1Pay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÇ‡∏≠‡∏ó‡∏µ 1.5 ‡πÅ‡∏£‡∏á</span>
      <span class="col-2"style="text-align:right;">${format2(ot15Hours)} ‡∏ä‡∏°.</span>
      <span class="col-3 money">${format2(ot15Pay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÇ‡∏≠‡∏ó‡∏µ 2 ‡πÅ‡∏£‡∏á</span>
      <span class="col-2"style="text-align:right;">${format2(ot2Hours)} ‡∏ä‡∏°.</span>
      <span class="col-3 money">${format2(ot2Pay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÇ‡∏≠‡∏ó‡∏µ 3 ‡πÅ‡∏£‡∏á</span>
      <span class="col-2"style="text-align:right;">${format2(ot3Hours)} ‡∏ä‡∏°.</span>
      <span class="col-3 money">${format2(ot3Pay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <hr>

    <div class="triple-row">
      <span class="col-1">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
      <span class="col-2"style="text-align:right;">${format2(cHolidaySpecial)} ‡∏ß‡∏±‡∏ô</span>
      <span class="col-3 money">${format2(holidayspecialPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</span>
      <span class="col-2"style="text-align:right;">${format2(cVacation)} ‡∏ß‡∏±‡∏ô</span>
      <span class="col-3 money">${format2(vacationPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</span>
      <span class="col-2"style="text-align:right;">${format2(cSickDoctor)} ‡∏ß‡∏±‡∏ô</span>
      <span class="col-3 money">${format2(sickdocterPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
      <span class="col-2"style="text-align:right;">${format2(cBusinessExtra)} ‡∏ß‡∏±‡∏ô</span>
      <span class="col-3 money">${format2(businessextraPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <hr>

    <div class="triple-row">
      <span class="col-1">‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡∏î‡∏∂‡∏Å</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(nightShiftPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏∞‡∏î‡∏∂‡∏Å</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(nightFoodPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£ OT</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(otFoodPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(skillPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏Ñ‡πà‡∏≤‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(mentorPay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏¢‡∏±‡∏ô</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(incentive1Pay+incentive2Pay)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <hr>

    <div class="triple-row">
      <span class="col-1"><b>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</b></span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(totalIncome)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <div class="triple-row">
      <span class="col-1">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°</span>
      <span class="col-2"></span>
      <span class="col-3 money">${format2(socialSecurity)} ‡∏ö‡∏≤‡∏ó</span>
    </div>

    <hr>

    <div class="triple-row" style="font-size:20px;background:#2e7d32;color:#ffffff;border-radius: 5px;">
      <span class="col-1"><b>&nbsp;‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</b></span>
      <span class="col-2"></span>
      <span class="col-3 money">
        ${format2(netPay)} ‡∏ö‡∏≤‡∏ó&nbsp;
      </span>
    </div>

    <div style="font-size:8px;"><br><br>
      <span class="col-3 money">***‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡∏°‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏ç‡∏≤‡∏ì‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô***</span>
    </div>

    <div id="result" style="margin-top:20px;">
    </div>
  </div>
`;
}
/* ===== 1. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ===== */
function saveSettings() {
    const y = yearSelect.value;
    const m = monthSelect.value;
    
    const settings = {
        skill: document.getElementById("skillCheck").checked,
        mentor: document.getElementById("mentorCheck").checked,
        dailyWage: dailyInput.value,
        incentive1: document.getElementById("incentive1").value,
        incentive2: document.getElementById("incentive2").value
    };
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    localStorage.setItem(`settings-${y}-${m}`, JSON.stringify(settings));
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    localStorage.setItem('lastViewedMonth', m);
    localStorage.setItem('lastViewedYear', y);
}

/* ===== 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ===== */
function loadSettings() {
    const y = yearSelect.value;
    const m = monthSelect.value;
    const saved = JSON.parse(localStorage.getItem(`settings-${y}-${m}`));
    
    if (saved) {
        document.getElementById("skillCheck").checked = saved.skill;
        document.getElementById("mentorCheck").checked = saved.mentor;
        dailyInput.value = saved.dailyWage || 447;
        document.getElementById("incentive1").value = saved.incentive1 || "0";
        document.getElementById("incentive2").value = saved.incentive2 || "0";
    } else {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        document.getElementById("skillCheck").checked = false;
        document.getElementById("mentorCheck").checked = false;
        dailyInput.value = 447; 
        document.getElementById("incentive1").value = "0";
        document.getElementById("incentive2").value = "0";
    }
    syncHourly();
}

/* ===== 3. ‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå (Events) ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ===== */
monthSelect.onchange = () => { 
    // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á saveSettings ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà 
    // ‡πÅ‡∏Ñ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏û‡∏≠
    loadSettings(); 
    renderMonth(); 
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏π‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà
    localStorage.setItem('lastViewedMonth', monthSelect.value);
};

yearSelect.onchange = () => { 
    loadSettings(); 
    renderMonth(); 
    localStorage.setItem('lastViewedYear', yearSelect.value);
};

// ‡∏™‡πà‡∏ß‡∏ô Input ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤
dailyInput.oninput = () => { syncHourly(); saveSettings(); renderSummary(); };
document.getElementById("skillCheck").onchange = () => { saveSettings(); renderSummary(); };
document.getElementById("mentorCheck").onchange = () => { saveSettings(); renderSummary(); };
document.getElementById("incentive1").onchange = () => { saveSettings(); renderSummary(); };
document.getElementById("incentive2").onchange = () => { saveSettings(); renderSummary(); };
/* ===== ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏∏‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å ===== */
document.addEventListener("click", function(event) {
    if (!expandRow) return; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const isClickInsideCalendar = calendarEl.contains(event.target);
    const isClickInsideCard = expandRow.contains(event.target);
    
    if (!isClickInsideCalendar && !isClickInsideCard) {
        slideClose(expandRow).then(() => {
            removeExpand(true);
            if (activeCell) activeCell.classList.remove("active");
            selectedDate = null;
            activeCell = null;
        });
    }
});

document.getElementById("pdfBtn").onclick = () => {
    // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢
    renderSummary(); 
    
    // 2. ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏µ‡∏à‡∏≤‡∏Å Dropdown
    const monthName = monthSelect.options[monthSelect.selectedIndex].text; // ‡πÄ‡∏ä‡πà‡∏ô December (‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°, ...)
    const yearValue = yearSelect.value; // ‡πÄ‡∏ä‡πà‡∏ô 2025
    
    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏° Dropdown
    // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å monthNames ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏ß‡πâ
    const monthEN = ["January", "February", "March", "April", "May", "June", 
                     "July", "August", "September", "October", "November", "December"];
    const mIdx = monthSelect.value;
    
    // 3. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: Payroll_2025_December.pdf
    const fileName = `Payroll_${yearValue}_${monthEN[mIdx]}`;
    
    // 4. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå PDF
    const originalTitle = document.title;
    document.title = fileName;
    
    // 5. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
    const res = document.getElementById("result");
    res.setAttribute("data-period", `‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏á‡∏ß‡∏î ${monthName} ${yearValue}`);
    
    // 6. ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    window.print();
    
    // 7. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    setTimeout(() => {
        document.title = originalTitle;
    }, 1000);
};

// --- 2. ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Export JSON) ---
document.getElementById("exportBtn").onclick = () => {
    const backupData = {};
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• payroll ‡πÅ‡∏•‡∏∞ settings
        if (key.includes("payroll-") || key.includes("settings-")) {
            backupData[key] = localStorage.getItem(key);
        }
    }
    const blob = new Blob([JSON.stringify(backupData)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `payroll_backup_${new Date().toLocaleDateString()}.json`;
    a.click();
};

// --- 3. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Import JSON) ---
document.getElementById("importBtn").onclick = () => document.getElementById("fileInput").click();

document.getElementById("fileInput").onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
        try {
            const data = JSON.parse(event.target.result);
            if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö")) {
                Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
                alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                location.reload();
            }
        } catch (err) { alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
    };
    reader.readAsText(file);
};
/* ===== ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (initApp) ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ===== */
function initApp() {
    const now = new Date();

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏õ‡∏µ" (‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 1 ‡∏õ‡∏µ ‡πÅ‡∏•‡∏∞ ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏õ‡∏µ)
    yearSelect.innerHTML = "";
    for (let y = now.getFullYear() - 1; y <= now.getFullYear() + 1; y++) {
        const o = document.createElement("option");
        o.value = y;
        o.textContent = y;
        yearSelect.appendChild(o);
    }

    // 2. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const savedMonth = localStorage.getItem('lastViewedMonth');
    const savedYear = localStorage.getItem('lastViewedYear');

    // 3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ Dropdown (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á)
    if (savedMonth !== null && savedYear !== null) {
        monthSelect.value = savedMonth;
        yearSelect.value = savedYear;
    } else {
        monthSelect.value = now.getMonth();
        yearSelect.value = now.getFullYear();
    }

    // 4. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    loadSettings(); 
    renderMonth(); 
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
initApp();
</script>

</body>
</html>
